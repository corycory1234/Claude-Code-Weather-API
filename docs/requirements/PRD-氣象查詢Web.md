# 氣象查詢Web專案 - 產品需求文檔 (PRD)

**文檔版本**：v1.0
**最後更新**：2025-01-04
**負責人**：Product Manager

---

## 一、專案概述

### 專案背景
開發一個全球氣象查詢Web應用，讓用戶能快速查詢任何城市的即時天氣資訊。

### 目標用戶
- 需要查詢全球天氣的一般使用者
- 無需註冊登入，開放使用

### 核心價值
- **簡單快速**：輸入城市名稱即可查詢
- **資訊清晰**：重點突出當前氣溫與風速
- **多語支援**：繁體中文 / English

---

## 二、MVP 功能規格

### 功能 1：城市天氣搜尋

#### 概述
用戶可以搜尋全球任何城市，立即查看該地當日天氣資訊。

#### 搜尋方式
- **輸入方式**：
  - 城市名稱（如：台北、Taipei、Tokyo）
  - 支援中英文輸入
  - 自動偵測輸入語言

- **搜尋體驗**：
  - 即時搜尋建議（輸入2個字後觸發）
  - 熱門城市快速選擇（預設顯示8-10個熱門城市）
  - 記住最後查詢的城市（使用 localStorage）
  - 支援按 Enter 鍵執行搜尋

#### 資料來源
**OpenWeatherMap API**
- 免費方案：60 calls/分鐘，1,000,000 calls/月
- 提供：當日天氣 + 7天預報
- 多語系支援：繁中、英文
- URL: https://openweathermap.org/api

#### 技術實現
```javascript
// 搜尋邏輯
- 使用 debounce 延遲 300ms 執行搜尋
- 快取最近搜尋結果（5分鐘）
- 錯誤處理：城市不存在、網路錯誤、API額度用盡
```

---

### 功能 2：當日氣象顯示

#### 顯示資訊（優先順序排列）

**P0（必須顯示）**：
- **氣溫**：
  - 當前溫度（攝氏 °C）
  - 體感溫度
  - 最高溫/最低溫（當日）

- **風速**：
  - 風速數值（公尺/秒 或 公里/小時）
  - 風向（東南西北）

**P1（建議顯示）**：
- 天氣狀況（晴天、多雲、雨天等）
- 天氣圖示（視覺化呈現）
- 濕度百分比
- 氣壓（hPa）

**P2（加分項目）**：
- 能見度
- 紫外線指數
- 日出/日落時間

#### 顯示格式範例
```
[城市名稱 + 國家]
台北市, 台灣

[主要溫度 - 大字體]
25°C

[體感溫度]
體感 27°C

[溫度範圍]
↑ 28°C  ↓ 22°C

[天氣描述]
☁️ 多雲

[風速資訊]
💨 東北風 3.5 m/s

[其他資訊 - 小卡片]
濕度 65%  |  氣壓 1013 hPa
```

---

### 功能 3：多語系切換

#### 支援語言
1. **繁體中文**（預設）
2. **English**

#### 切換機制
- **切換位置**：頁面右上角
- **切換方式**：下拉選單或旗幟圖示按鈕
- **記憶功能**：使用 localStorage 記住用戶偏好
- **切換範圍**：
  - UI 所有文字標籤
  - 天氣描述（API 支援）
  - 溫度單位標示

#### 需要翻譯的內容
```javascript
{
  // 搜尋相關
  "search_placeholder": "搜尋城市...",
  "popular_cities": "熱門城市",
  "search_error": "找不到此城市",

  // 天氣資訊
  "feels_like": "體感溫度",
  "wind_speed": "風速",
  "humidity": "濕度",
  "pressure": "氣壓",

  // 風向
  "north": "北風",
  "south": "南風",
  "east": "東風",
  "west": "西風"
}
```

---

## 三、用戶故事

### US-001：城市搜尋

**故事編號**：US-001
**優先級**：P0
**故事點數**：3

**作為** 使用者
**我希望** 搜尋任何城市的天氣
**以便** 快速了解該地的即時天氣狀況

#### 驗收標準
- [ ] 假設我輸入城市名稱，當輸入超過2個字元，則顯示最多5個搜尋建議
- [ ] 假設我選擇一個城市，當點擊確認，則在1秒內顯示該城市天氣資訊
- [ ] 假設城市名稱無效，當搜尋無結果，則顯示「找不到此城市，請檢查拼寫」
- [ ] 假設我開啟網站，當頁面載入完成，則自動顯示預設城市（台北）的天氣
- [ ] 假設我曾經搜尋過城市，當再次開啟網站，則自動載入上次查詢的城市

#### 資料需求
- **API 端點**：`GET /weather?q={cityName}&lang={language}`
- **必要回應資料**：
  ```json
  {
    "city": "Taipei",
    "country": "TW",
    "temperature": 25,
    "feels_like": 27,
    "temp_min": 22,
    "temp_max": 28,
    "wind_speed": 3.5,
    "wind_deg": 45
  }
  ```

#### UI 需求
- **桌面版**：頂部中央搜尋框，寬度 400px，圓角設計
- **手機版**：頂部全寬搜尋框，固定位置
- **搜尋建議**：下拉選單，包含城市名稱 + 國家旗幟

#### 成功指標
- 搜尋成功率 > 95%
- 平均回應時間 < 1.5 秒

---

### US-002：當日天氣顯示

**故事編號**：US-002
**優先級**：P0
**故事點數**：5

**作為** 使用者
**我希望** 看到清晰的當日天氣資訊
**以便** 了解當前溫度、風速等關鍵氣象數據

#### 驗收標準
- [ ] 假設天氣資料載入成功，當頁面顯示，則呈現當前溫度（大字體，視覺焦點）
- [ ] 假設顯示溫度，當同時呈現體感溫度，則使用較小字體標註「體感」
- [ ] 假設顯示風速，當包含風向資訊，則使用箭頭圖示 + 文字（如「東北風」）
- [ ] 假設在手機上瀏覽，當螢幕寬度 < 768px，則資訊卡片垂直堆疊
- [ ] 假設天氣資料載入中，當 API 尚未回應，則顯示骨架屏（skeleton）載入動畫

#### 資料需求
- **主要資料**：
  - 當前溫度（°C）
  - 體感溫度（°C）
  - 最高/最低溫（°C）
  - 風速（m/s 或 km/h）
  - 風向（度數，需轉換為方位）

- **次要資料**：
  - 天氣狀況代碼（用於顯示圖示）
  - 濕度（%）
  - 氣壓（hPa）

#### UI 需求
- **桌面版**：
  - 主資訊卡片：置中顯示，最大寬度 600px
  - 溫度：72px 字體大小
  - 次要資訊：網格佈局（2列）

- **手機版**：
  - 全寬顯示，左右 padding 16px
  - 溫度：48px 字體大小
  - 次要資訊：單列堆疊

#### 成功指標
- 資料顯示完整度 = 100%（所有P0資料必須呈現）
- 頁面首次繪製 < 2 秒

---

### US-003：語言切換

**故事編號**：US-003
**優先級**：P0
**故事點數**：2

**作為** 使用者
**我希望** 切換介面語言（繁中/英文）
**以便** 用我熟悉的語言瀏覽天氣資訊

#### 驗收標準
- [ ] 假設我點擊語言切換按鈕，當選擇語言，則介面所有文字立即切換（< 0.5秒）
- [ ] 假設切換語言，當重新整理頁面，則保持我選擇的語言（使用 localStorage）
- [ ] 假設切換語言，當天氣描述也跟著切換，則顯示對應語言的天氣狀況（如「多雲」↔「Cloudy」）
- [ ] 假設首次訪問網站，當未設定語言偏好，則預設顯示繁體中文
- [ ] 假設在手機上，當點擊語言切換，則顯示易於點擊的選項（最小觸控區域 44px）

#### 資料需求
- **語言配置檔**：
  ```javascript
  // i18n/zh-TW.js
  export default {
    search: "搜尋城市...",
    temperature: "溫度",
    feels_like: "體感",
    wind: "風速",
    // ... 其他翻譯
  }

  // i18n/en.js
  export default {
    search: "Search city...",
    temperature: "Temperature",
    feels_like: "Feels like",
    wind: "Wind speed",
    // ... other translations
  }
  ```

- **API 語言參數**：
  - 繁中：`lang=zh_tw`
  - 英文：`lang=en`

#### UI 需求
- **桌面版**：
  - 位置：右上角
  - 樣式：下拉選單 或 切換開關
  - 顯示：旗幟圖示 + 語言代碼（🇹🇼 繁中 / 🇬🇧 EN）

- **手機版**：
  - 位置：右上角
  - 樣式：僅顯示旗幟圖示（節省空間）
  - 點擊後展開選項

#### 成功指標
- 語言切換成功率 = 100%
- 切換後 UI 無殘留未翻譯文字

---

## 四、資料需求總覽

### OpenWeatherMap API 整合

#### 當日天氣 API
```bash
GET https://api.openweathermap.org/data/2.5/weather
參數:
  - q: 城市名稱 (例: Taipei)
  - lang: 語言 (zh_tw 或 en)
  - units: metric (攝氏溫度)
  - appid: API Key
```

#### API 回應範例
```json
{
  "coord": {
    "lon": 121.5319,
    "lat": 25.0478
  },
  "weather": [
    {
      "id": 803,
      "main": "Clouds",
      "description": "多雲",
      "icon": "04d"
    }
  ],
  "main": {
    "temp": 25.5,
    "feels_like": 27.2,
    "temp_min": 22.0,
    "temp_max": 28.0,
    "pressure": 1013,
    "humidity": 65
  },
  "wind": {
    "speed": 3.5,
    "deg": 45
  },
  "name": "Taipei",
  "sys": {
    "country": "TW"
  }
}
```

### 資料處理邏輯

#### 1. 風向轉換
```javascript
const getWindDirection = (deg) => {
  const directions = ['北', '東北', '東', '東南', '南', '西南', '西', '西北'];
  const index = Math.round(deg / 45) % 8;
  return directions[index];
}
```

#### 2. 時間格式化
```javascript
const formatTime = (timestamp) => {
  return new Date(timestamp * 1000).toLocaleTimeString(locale);
}
```

---

## 五、UI/UX 需求概述

### 主要頁面佈局

#### 桌面版佈局（≥ 768px）
```
┌─────────────────────────────────────┐
│  Logo        [搜尋框]        [語言] │  ← Header (固定)
├─────────────────────────────────────┤
│                                     │
│         ┌─────────────────┐         │
│         │   台北市, 台灣   │         │
│         │                 │         │
│         │      25°C       │         │  ← 主資訊卡片
│         │   體感 27°C      │         │
│         │   ↑28° ↓22°     │         │
│         │                 │         │
│         │  ☁️ 多雲         │         │
│         │  💨 東北風 3.5m/s │         │
│         │                 │         │
│         │  [濕度] [氣壓]   │         │
│         └─────────────────┘         │
│                                     │
└─────────────────────────────────────┘
```

#### 手機版佈局（< 768px）
```
┌───────────────────┐
│ Logo  [語言]      │  ← Header
├───────────────────┤
│  [搜尋框]         │  ← 搜尋區
├───────────────────┤
│                   │
│  台北市, 台灣      │
│                   │
│      25°C         │  ← 主資訊
│    體感 27°C       │
│   ↑28° ↓22°       │
│                   │
│   ☁️ 多雲          │
│   💨 東北風 3.5m/s  │
│                   │
│  [濕度]           │  ← 次要資訊
│  [氣壓]           │     (垂直堆疊)
│                   │
└───────────────────┘
```

### 關鍵互動元素

#### 1. 搜尋框狀態
- **Default**：灰色邊框，placeholder 顯示
- **Focus**：藍色邊框，顯示搜尋圖示
- **Typing**：顯示清除按鈕（X）
- **Loading**：顯示載入動畫
- **Error**：紅色邊框 + 錯誤訊息

#### 2. 天氣卡片狀態
- **Loading**：骨架屏（灰色漸層動畫）
- **Success**：顯示完整資料
- **Error**：顯示錯誤訊息 + 重試按鈕

#### 3. 熱門城市快速選擇
建議城市列表：
- 台北 (Taipei)
- 東京 (Tokyo)
- 紐約 (New York)
- 倫敦 (London)
- 巴黎 (Paris)
- 雪梨 (Sydney)
- 新加坡 (Singapore)
- 首爾 (Seoul)

---

## 六、技術架構

### 前端技術棧
- **框架**：React 19
- **建構工具**：Vite
- **樣式**：Tailwind CSS
- **狀態管理**：React Context API
- **HTTP 請求**：fetch API
- **國際化**：自訂 i18n 解決方案

### 狀態管理結構
```javascript
{
  currentCity: "Taipei",
  weatherData: {...},
  language: "zh-TW",
  isLoading: false,
  error: null
}
```

### API 服務層
```javascript
// services/weatherAPI.js
export const getWeatherByCity = async (cityName, lang) => {
  const API_KEY = import.meta.env.VITE_WEATHER_API_KEY;
  const response = await fetch(
    `https://api.openweathermap.org/data/2.5/weather?q=${cityName}&lang=${lang}&units=metric&appid=${API_KEY}`
  );
  return response.json();
};
```

### 快取策略
- 使用 TanStack Query（React Query）或自訂快取
- 快取時間：5 分鐘
- 背景自動更新

---

## 七、效能指標

| 指標 | 目標值 |
|------|--------|
| 首次內容繪製（FCP） | < 1.5 秒 |
| 最大內容繪製（LCP） | < 2.5 秒 |
| API 回應時間 | < 1 秒 |
| 語言切換速度 | < 0.5 秒 |
| 搜尋建議延遲 | 300ms (debounce) |

---

## 八、開發階段規劃

### Phase 1: MVP（當前階段）
- ✅ 城市搜尋功能
- ✅ 當日天氣顯示（氣溫 + 風速）
- ✅ 多語系切換（繁中/英文）

### Phase 2: 功能擴充
- [ ] 未來 7 天預報
- [ ] 更多氣象資訊（降雨機率、空氣品質）
- [ ] 收藏城市功能

### Phase 3: 體驗優化
- [ ] PWA 支援（離線使用）
- [ ] 深色模式
- [ ] 更多語言支援

---

## 九、風險與挑戰

### 技術風險
1. **API 限制**：
   - 免費版有請求次數限制
   - 緩解：實作快取機制，避免重複請求

2. **城市名稱辨識**：
   - 同名城市問題（如：多個 Springfield）
   - 緩解：顯示國家/地區資訊供用戶區分

3. **資料準確性**：
   - API 資料更新頻率
   - 緩解：顯示資料更新時間

### 用戶體驗風險
1. **搜尋體驗**：
   - 輸入錯誤城市名稱
   - 緩解：模糊搜尋、拼寫建議

2. **載入時間**：
   - API 回應慢
   - 緩解：骨架屏、快取機制

---

## 十、附錄

### API Key 配置
```bash
# .env.local
VITE_WEATHER_API_KEY=your_api_key_here
VITE_WEATHER_API_BASE_URL=https://api.openweathermap.org/data/2.5
VITE_DEFAULT_CITY=Taipei
VITE_DEFAULT_LANGUAGE=zh_tw
```

### 參考資源
- OpenWeatherMap API 文檔: https://openweathermap.org/api
- React 19 文檔: https://react.dev
- Tailwind CSS 文檔: https://tailwindcss.com

---

**文檔結束**
